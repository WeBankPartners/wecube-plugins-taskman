<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webank.taskman.mapper.RequestTemplateMapper">

    <resultMap id="BaseResultMap" type="com.webank.taskman.domain.RequestTemplate">
        <id column="id" property="id"/>
        <result column="request_temp_group" property="requestTempGroup" />
        <result column="proc_def_key" property="procDefKey" />
        <result column="proc_def_id" property="procDefId" />
        <result column="proc_def_name" property="procDefName" />
        <result column="name" property="name" />
        <result column="description" property="description" />
        <result column="version" property="version" />
        <result column="tags" property="tags" />
        <result column="status" property="status" />
        <result column="created_by" property="createdBy" />
        <result column="created_time" property="createdTime" />
        <result column="updated_by" property="updatedBy" />
        <result column="updated_time" property="updatedTime" />
        <result column="del_flag" property="delFlag" />
    </resultMap>


    <select id="selectPageByParam" parameterType="com.webank.taskman.dto.req.QueryRequestTemplateReq"
            resultMap="BaseResultMap">
        SELECT rt.*,rtg.name FROM request_template rt,
        INNER JOIN request_template_group rtg ON rt.request_template_group = rtg.id
        <where>
            <if test="param.requestTempGroup !=null and param.requestTempGroup !='' ">
                AND rtg.id = #{param.requestTempGroup}
            </if>
        </where>
        <where>
            <if test="param.id !=null and param.id != ''">
                AND rt.id = #{param.id}
            </if>
            <if test="param.procDefKey !=null and param.procDefKey != ''">
                AND rt.proc_def_key = #{param.procDefKey}
            </if>
            <if test="param.procDefId !=null and param.procDefId != ''">
                AND rt.proc_def_id = #{param.procDefId}
            </if>
            <if test="param.procDefName !=null and param.procDefName != ''">
                AND rt.proc_def_name = #{param.procDefName}
            </if>
            <if test="param.name !=null and param.name != ''">
                AND rt.name like CONCAT('%',#{param.name},'%')
            </if>
            <if test="param.tags !=null and param.tags != ''">
                AND rt.tags like CONCAT('%',#{param.tags},'%')
            </if>
            <if test="param.status !=null and param.status != ''">
                AND rt.status = #{param.status}
            </if>
            <if test="param.conditionSql!=null and param.conditionSql !=''">
                AND ${param.conditionSql}
            </if>
        </where>

    </select>

    <select id="selectSynthesisRequestTemple" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT rt.*
        FROM
        request_template rt
        <where>
            <if test="conditionSql!=null and conditionSql !=''">
                AND ${conditionSql}
            </if>
        </where>
    </select>

    <resultMap id="DTOResultMap" type="com.webank.taskman.dto.RequestTemplateDTO" >
        <id column="id" property="id"/>
        <result column="request_temp_group" property="requestTempGroup" />
        <result column="request_temp_group_name" property="requestTempGroupName" />
        <result column="proc_def_key" property="procDefKey" />
        <result column="proc_def_id" property="procDefId" />
        <result column="proc_def_name" property="procDefName" />
        <result column="name" property="name" />
        <result column="description" property="description" />
        <result column="version" property="version" />
        <result column="tags" property="tags" />
        <result column="status" property="status" />
    </resultMap>

    <select id="selectDTOListByParam" resultMap="DTOResultMap" parameterType="com.webank.taskman.dto.req.QueryRequestTemplateReq">
        SELECT rt.*,rtg.name FROM  request_template rt
        INNER JOIN request_template_group rtg ON rt.request_template_group = rtg.id
        <where>
            <if test="requestTempGroup !=null and requestTempGroup !='' ">
                AND rtg.id = #{requestTempGroup}
            </if>
        </where>
        <where>
            <if test="id !=null and id != ''">
                AND rt.id = #{id}
            </if>
            <if test="procDefKey !=null and procDefKey != ''">
                AND rt.proc_def_key = #{procDefKey}
            </if>
            <if test="procDefId !=null and procDefId != ''">
                AND rt.proc_def_id = #{procDefId}
            </if>
            <if test="procDefName !=null and procDefName != ''">
                AND rt.proc_def_name = #{procDefName}
            </if>
            <if test="name !=null and name != ''">
                AND rt.name like CONCAT('%',#{name},'%')
            </if>
            <if test="tags !=null and tags != ''">
                AND rt.tags like CONCAT('%',#{tags},'%')
            </if>
            <if test="status !=null and status != ''">
                AND rt.status = #{status}
            </if>
            <if test="conditionSql!=null and conditionSql !=''">
                AND ${conditionSql}
            </if>
        </where>
    </select>

</mapper>
